<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApiOutput.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">s0</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs.student.main.server</a> &gt; <span class="el_source">ApiOutput.java</span></div><h1>ApiOutput.java</h1><pre class="source lang-java linenums">package edu.brown.cs.student.main.server;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.util.stream.Collectors;

/**
 * Our APIOutput is the actual class that makes the calls to the US census API. Utilizes 4 methods *
 * to accomplish this.
 */
public class ApiOutput implements Icache {

  /**
   * The constructor itself is empty and doesnâ€™t have functionality outside of allowing users to
   * call the methods below.
   */
<span class="fc" id="L20">  public ApiOutput() {}</span>

  /**
   * This is the method that handles the main logic of the calls to the API, it utilizes all other
   * functions defined in the class as helpers to make calls to the US census API given necessary
   * location information.
   *
   * @param locationInfo -&gt; this is a string that contains both the state and the county that the
   *     user is looking for in the API, input should separate the state and the county with a
   *     comma.
   * @return -&gt; The exact data retrieved from the API
   * @throws IOException throws an error if the info can't be fetched correctly
   */
  @Override
  public String output(String locationInfo) throws IOException {
<span class="fc" id="L35">    String[] strList = locationInfo.split(&quot;,&quot;);</span>
<span class="fc" id="L36">    String state = strList[0];</span>
<span class="fc" id="L37">    String county = strList[1];</span>
<span class="pc bpc" id="L38" title="3 of 4 branches missed.">    if (state.matches(&quot;\\d+&quot;) &amp;&amp; county.matches(&quot;\\d+&quot;)) {</span>
<span class="nc" id="L39">      URL url =</span>
          new URL(
              &quot;https://api.census.gov/data/2021/acs/acs1/subject/variables?get=NAME,S2802_C03_022E&amp;for=county:&quot;
                  + county
                  + &quot;&amp;in=state:&quot;
                  + state);
<span class="nc" id="L45">      return setUpCall(url);</span>
    } else {
<span class="fc" id="L47">      String stateNum = ApiUtilities.fromJsonMap(getStates(), true).get(state);</span>
<span class="fc bfc" id="L48" title="All 2 branches covered.">      if (stateNum == null) {</span>
<span class="fc" id="L49">        throw new NullPointerException(</span>
            &quot;error_bad_request. state entered not Found: Please enter a valid state&quot;);
      }

<span class="fc" id="L53">      String countyNum = ApiUtilities.fromJsonMapCounties(getCounties(stateNum), true).get(county);</span>
<span class="fc bfc" id="L54" title="All 2 branches covered.">      if (countyNum == null) {</span>
<span class="fc" id="L55">        throw new NullPointerException(</span>
            &quot;error_bad_request. county entered not Found: Please enter a valid county for &quot;
                + state);
      }
<span class="fc" id="L59">      URL url =</span>
          new URL(
              &quot;https://api.census.gov/data/2021/acs/acs1/subject/variables?get=NAME,S2802_C03_022E&amp;for=county:&quot;
                  + countyNum
                  + &quot;&amp;in=state:&quot;
                  + stateNum);
<span class="fc" id="L65">      return setUpCall(url);</span>
    }
  }

  /**
   * getStates method uses a different API from the one in output to get information about states
   * and their relative state codes.
   *
   * @return Data from the URL provided
   * @throws IOException throws an error if the info can't be fetched correctly
   */
  @Override
  public String getStates() throws IOException {
<span class="fc" id="L78">    URL url = new URL(&quot;https://api.census.gov/data/2010/dec/sf1?get=NAME&amp;for=state:*&quot;);</span>
<span class="fc" id="L79">    return setUpCall(url);</span>
  }

  /**
   * getCounties method uses a different API from the one in output. Given a state, it gets
   * information about the states counties and their respective county codes.
   *
   * @param state State we want to search
   * @return Data from the URL provided
   * @throws IOException throws an error if the info can't be fetched correctly
   */
  @Override
  public String getCounties(String state) throws IOException {
<span class="fc bfc" id="L92" title="All 2 branches covered.">    if (state.isEmpty()) {</span>
<span class="fc" id="L93">      throw new IllegalArgumentException(&quot;error_bad_request. Please Enter a State and County&quot;);</span>
    }
<span class="fc" id="L95">    URL url =</span>
        new URL(&quot;https://api.census.gov/data/2010/dec/sf1?get=NAME&amp;for=county:*&amp;in=state:&quot; + state);
<span class="fc" id="L97">    return setUpCall(url);</span>
  }

  /**
   * This method handles the actual act of putting a request to an API. Given an API url as a
   * parameter, the method makes a request to that API. Used in all other methods in the class.
   *
   * @param url -&gt; for the specific API you're looking to get
   * @return String -&gt; raw data from url provided
   * @throws IOException throws an error if the info can't be fetched correctly
   */
  private String setUpCall(URL url) throws IOException {
<span class="fc" id="L109">    HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span>
<span class="fc" id="L110">    conn.setRequestMethod(&quot;GET&quot;);</span>
<span class="fc" id="L111">    conn.setRequestProperty(&quot;Accept&quot;, &quot;application/json&quot;);</span>
<span class="fc bfc" id="L112" title="All 2 branches covered.">    if (conn.getResponseCode() == 204) {</span>
<span class="fc" id="L113">      throw new NullPointerException(</span>
          &quot;error_datasource. Failed : HTTP Error input : Contents == &quot;
<span class="fc" id="L115">              + conn.getResponseMessage()</span>
              + &quot;,&quot;
<span class="fc" id="L117">              + conn.getResponseCode());</span>
    }
<span class="pc bpc" id="L119" title="1 of 2 branches missed.">    if (conn.getResponseCode() != 200) {</span>
<span class="nc" id="L120">      throw new RuntimeException(</span>
<span class="nc" id="L121">          &quot;error_datasource. Failed : HTTP Error code : &quot; + conn.getResponseMessage());</span>
    }
<span class="fc" id="L123">    InputStreamReader in = new InputStreamReader(conn.getInputStream());</span>
<span class="fc" id="L124">    BufferedReader br = new BufferedReader(in);</span>
<span class="fc" id="L125">    return br.lines().collect(Collectors.joining());</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>